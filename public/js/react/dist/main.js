!function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=0)}([function(e,t,n){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.r(t);var c=function(e){function t(e){var n,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,(n=!(i=r(t).call(this,e))||"object"!==s(i)&&"function"!=typeof i?a(o):i).state={hideUserList:!0},n.signOut=n.signOut.bind(a(n)),n.mouseOverHeadder=n.mouseOverHeadder.bind(a(n)),n.mouseOutHeadder=n.mouseOutHeadder.bind(a(n)),n.showUsersList=n.showUsersList.bind(a(n)),n}var n,c,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,React.Component),n=t,(c=[{key:"signOut",value:function(){document.cookie="login=",document.cookie="destination=",document.cookie="lastActiveUser=",document.location.href="/"}},{key:"mouseOverHeadder",value:function(){document.getElementsByClassName("headder")[0].id="headder_hover",document.getElementsByClassName("logo")[0].id="logo_hover",document.getElementsByClassName("signOut")[0].id="signOut_hover"}},{key:"mouseOutHeadder",value:function(){document.getElementsByClassName("headder")[0].id="headder",document.getElementsByClassName("logo")[0].id="logo",document.getElementsByClassName("signOut")[0].id="signOut"}},{key:"showUsersList",value:function(){var e=document.getElementsByClassName("usersList")[0],t=document.getElementsByClassName("chat")[0];1==this.state.hideUserList?(t.style.display="none",e.style.display="flex",this.setState({hideUserList:!1})):0==this.state.hideUserList&&(e.style.display="none",t.style.display="inline",this.setState({hideUserList:!0}))}},{key:"render",value:function(){return React.createElement("div",{className:"headder",id:"headder"},React.createElement("div",{className:"showUserList"},React.createElement("button",{onClick:this.showUsersList},"⚙")),React.createElement("div",{className:"logo",id:"logo",onMouseOver:this.mouseOverHeadder,onMouseOut:this.mouseOutHeadder},"MeChat"),React.createElement("div",{className:"username"},this.props.loginSplit),React.createElement("div",{className:"signOut",onClick:this.signOut,id:"signOut",onMouseOver:this.mouseOverHeadder,onMouseOut:this.mouseOutHeadder},React.createElement("button",null,"Выйти")))}}])&&o(n.prototype,c),u&&o(n,u),t}();function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function p(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=p(this,d(t).call(this,e))).state={message:e.message,sender:e.sender,show:!1},n.sender="",n.message="",n}var n,s,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,React.Component),n=t,(s=[{key:"showPopUp",value:function(){var e=this,t=document.getElementById("popUp");this.sender=this.state.sender,this.message=this.state.message,t.style.opacity=1,this.setState({show:!0},(function(){var n=setTimeout((function(){t.style.opacity=0,e.setState({show:!1},(function(){return clearTimeout(n)}))}),4e3)}))}},{key:"componentDidUpdate",value:function(e){var t=this;this.props.message===e.message&&this.props.sender===e.sender||this.setState({message:this.props.message,sender:this.props.sender},(function(){(""!=t.state.sender&&""!=t.state.message&&e.message!==t.props.message||e.sender!=t.props.sender)&&(0==t.state.show?t.showPopUp():1==t.state.show&&setTimeout((function(){t.showPopUp()}),3e3))}))}},{key:"render",value:function(){var e=this;return React.createElement("div",{className:"popUp",id:"popUp",onClick:function(){return e.props.userChange(e.sender)}},React.createElement("div",{className:"popUp_newMessage"},"New message from..."),React.createElement("div",{className:"popUpSender"},this.sender),React.createElement("div",{className:"popUpMessage"},this.message))}}])&&l(n.prototype,s),o&&l(n,o),t}();function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var S=[],E=function(e){function t(e){var n,s,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s=this,(n=!(o=v(t).call(this,e))||"object"!==y(o)&&"function"!=typeof o?b(s):o).state={messages:React.createElement("div",{className:"messageCover"},"Здесь будет показана история сообщений"),destination:"",socket:e.socket,readable:[1,2,3],popUpMsg:"",popUpSender:""},n.sendMessage=n.sendMessage.bind(b(n)),n.mouseOverSendButton=n.mouseOverSendButton.bind(b(n)),n.mouseOutSendButton=n.mouseOutSendButton.bind(b(n)),n.readKey=n.readKey.bind(b(n)),n}var n,s,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(t,React.Component),n=t,(s=[{key:"componentDidMount",value:function(){var e=this;this.state.socket.onopen=function(){e.state.socket.send(JSON.stringify({login:e.props.loginSplit,operation:"User connect"})),e.state.socket.onmessage=function(t){var n=JSON.parse(t.data);if("Send message"==n.operation&&e.props.otherUser==n.sender){var s=React.createElement("div",{className:"message",key:n.id,id:n.id},React.createElement("div",{className:"messageUsername"},n.sender),React.createElement("div",{className:"messageText"},n.message));S.push(s),e.state.socket.send(JSON.stringify({sender:e.props.loginSplit,reader:n.sender,id:n.id,operation:"Was read",wasRead:!1})),e.setState({messages:S})}else"Send message"==n.operation&&e.props.otherUser!=n.sender?(document.getElementById(n.sender).className="user unread",e.setState({popUpMsg:n.message,popUpSender:n.sender}),document.getElementById("messageSound").play()):"New user"==n.operation?e.props.getUsersList():"Was read"==n.operation&&n.reader==e.props.otherUser&&(document.getElementById(n.id).className="message",0==n.wasRead&&e.state.socket.send(JSON.stringify({sender:n.reader,reader:n.sender,id:n.id,operation:"Was read",wasRead:!0})))}},document.addEventListener("keydown",this.readKey),document.addEventListener("keyup",this.keyUp)}},{key:"componentDidUpdate",value:function(e){this.props.otherUser!==e.otherUser&&this.getMessages(),document.getElementsByClassName("messages")[0].scrollTop=document.getElementsByClassName("messages")[0].scrollHeight}},{key:"readKey",value:function(e){var t=document.getElementById("messageInput"),n=document.getElementsByClassName("sendButton")[0];t.focus(),"Enter"==e.code&&""!=t.value?(e.preventDefault(),this.sendMessage(),n.style.background="#3AB4A8"):"Enter"==e.code&&(e.preventDefault(),n.style.background="#3AB4A8")}},{key:"keyUp",value:function(e){"Enter"==e.code&&(document.getElementsByClassName("sendButton")[0].style.background="#A762E5")}},{key:"getMessages",value:function(){var e=this,t=this.props.otherUser;S=[],document.cookie="destination=".concat(t);var n="";getData("/messages").then((function(t){if("Empty"==t.response)e.setState({messages:React.createElement("div",{className:"messageCover"},"Здесь будет показана история сообщений")});else{for(var s in t)0==t[s].wasRead?(n="message unread",t[s].sender!=e.props.loginSplit&&(postData("/wasRead",{id:t[s]._id}),e.state.socket.send(JSON.stringify({sender:t[s].sender,reader:e.props.loginSplit,id:t[s]._id,operation:"Was read",wasRead:!1})))):n="message",S.push(React.createElement("div",{key:t[s]._id,id:t[s]._id,className:n},React.createElement("div",{className:"messageUsername"},t[s].sender),React.createElement("div",{className:"messageText"},t[s].message)));e.setState({messages:S})}}))}},{key:"sendMessage",value:function(){var e=this,t=document.getElementById("messageInput"),n=this.props.otherUser,s="",o={users:[this.props.loginSplit,n],destination:n,sender:this.props.loginSplit,messageText:t.value};""!=this.props.otherUser&&""!=t.value&&postData("/sendMessage",o).then((function(n){s=n.id,S.push(React.createElement("div",{key:s,id:s,className:"message unread"},React.createElement("div",{className:"messageUsername"},e.props.loginSplit),React.createElement("div",{className:"messageText"},t.value))),o.operation="Send message",o.id=s,e.state.socket.send(JSON.stringify(o)),e.setState({messages:S},(function(){document.getElementsByClassName("messages")[0].scrollTop=document.getElementsByClassName("messages")[0].scrollHeight,t.value=""}))}))}},{key:"mouseOverSendButton",value:function(){document.getElementById("messageInput").className="messageInput_hover"}},{key:"mouseOutSendButton",value:function(){document.getElementById("messageInput").className="messageInput"}},{key:"render",value:function(){var e;return React.createElement("div",{className:"chat"},React.createElement("div",{className:"messages"},this.state.messages),React.createElement("div",{className:"messageSender"},React.createElement("textarea",(g(e={name:"",id:"messageInput",cols:"60",rows:"2",className:"messageInput"},"id","messageInput"),g(e,"placeholder","Напишите сообщение..."),e)),React.createElement("button",{className:"sendButton",onClick:this.sendMessage,onMouseOver:this.mouseOverSendButton,onMouseOut:this.mouseOutSendButton},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},React.createElement("path",{d:"M24 0l-6 22-8.129-7.239 7.802-8.234-10.458 7.227-7.215-1.754 24-12zm-15 16.668v7.332l3.258-4.431-3.258-2.901z"})))),React.createElement(f,{sender:this.state.popUpSender,message:this.state.popUpMsg,userChange:this.props.userChange}))}}])&&h(n.prototype,s),o&&h(n,o),t}();function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(e){function t(e){var n,s,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s=this,(n=!(o=U(t).call(this,e))||"object"!==w(o)&&"function"!=typeof o?N(s):o).state={list:"",activeUser:"",socket:new WebSocket("ws://localhost:3001")},n.userChange=n.userChange.bind(N(n)),n}var n,s,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(t,React.Component),n=t,(s=[{key:"componentDidMount",value:function(){var e=this,t=[],n=[];getData("/UsersList").then((function(s){for(var o in s)e.props.loginSplit!=s[o].login&&(t.push(React.createElement("div",{key:s[o]._id,id:s[o].login,onClick:e.userChange.bind(e,s[o].login),className:"user"},s[o].login)),n.push(s[o].login));e.setState({list:t}),""!=e.props.lastActiveUser&&e.userChange(e.props.lastActiveUser),postData("/findMessages",{login:e.props.loginSplit}).then((function(t){var n="";if("Empty"!=t.response)for(var s in t)t[s].sender!=e.props.loginSplit&&(n=t[s].users[0]==e.props.loginSplit?t[s].users[1]:t[s].users[0]),document.getElementById(n).className="user unread"}))}))}},{key:"getUsersList",value:function(){var e=this,t=[],n=[];getData("/UsersList").then((function(s){for(var o in s)e.props.loginSplit!=s[o].login&&(t.push(React.createElement("div",{key:s[o]._id,id:s[o].login,onClick:e.userChange.bind(e,s[o].login),className:"user"},s[o].login)),n.push(s[o].login));e.setState({list:t})}))}},{key:"userChange",value:function(e){""!=this.state.activeUser&&""!=e&&(document.getElementById(this.state.activeUser).className="User"),document.getElementById(e).className="UserClicked",this.setState({activeUser:e}),document.cookie="lastActiveUser=".concat(e)}},{key:"render",value:function(){return React.createElement("div",{className:"content"},React.createElement("div",{className:"usersList"},this.state.list),React.createElement(E,{loginSplit:this.props.loginSplit,otherUser:this.state.activeUser,socket:this.state.socket,userChange:this.userChange}))}}])&&k(n.prototype,s),o&&k(n,o),t}();function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function B(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e){return React.createElement("audio",{src:"messageSound.mp3",id:"messageSound"})}var T=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=B(this,P(t).call(this,e))).state={loginSplit:"",lastActiveUser:""},n}var n,s,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(t,React.Component),n=t,(s=[{key:"componentDidMount",value:function(){for(var e=document.cookie.split(";"),t="",n="",s=0;s<e.length;s++){var o=e[s].split("=");"login"!=o[0]&&" login"!=o[0]||(t=o[1]),("lastActiveUser"==o[0]||" lastActiveUser"==o[0]&&""!=o[1])&&(n=o[1])}this.setState({lastActiveUser:n,loginSplit:t})}},{key:"render",value:function(){return React.createElement("div",{className:"wrapper"},React.createElement(I,null),React.createElement(c,{loginSplit:this.state.loginSplit}),React.createElement(_,{lastActiveUser:this.state.lastActiveUser,loginSplit:this.state.loginSplit}))}}])&&j(n.prototype,s),o&&j(n,o),t}();ReactDOM.render(React.createElement(T,null),document.getElementById("root"))}]);